---
title: 图片旋转之Exif信息
date: 2024-05-07 00:00:00
image: 1.png
categories: ["前端"]
weight: 1 
---

同一张图片，在用户手机里正常显示，然而上传图片的时候，在打开图片水印的情况下，上传的图片会自动旋转，关闭水印则不会出现这个情况。
首先定位问题原因：图片上传自动旋转肯定是Exif携带了旋转信息

### Exif

Exif维基百科介绍如下：
> 可交换图像文件格式（英语：Exchangeable image file format，官方简称Exif），是专门为数码相机的照片设定的文件格式，可以记录数码照片的属性信息和拍摄数据。  
> Exif可以附加于JPEG、TIFF、RIFF等文件之中，为其增加有关数码相机拍摄信息的内容和索引图或图像处理软件的版本信息。

如何查询exif信息，可以通过[图虫](https://exif.tuchong.com/)在线上传查看
把出现问题的图片上传，可以发现图片携带了90度的旋转：
![Exif信息](<Pasted image 20240506173200.png>)
这里的 `Rotate 90 CW` 代表图像需要顺时针旋转 90 度才能正确显示。
再返回查看系统上传的图片，果然相对于正常图片逆时针旋转了90度

### 图片旋转的原因

一些手机拍摄照片会带有90°的旋转角，而我们在手机或者浏览器上查看的时候，因为两者都读取了Exif信息并根据信息对图片进行了适应，它将基于方向信息自动旋转原始图像，所以我们看到的就是我们拍摄的，如果使用不能读取Exif信息的软件查看，看到的图片就是旋转之前的。

### 跟水印又有什么关系

前面提到只有在打开水印的情况下图片才会旋转，这又是为什么呢？
查看前端代码，发现前端没有对图片做任何旋转处理，水印开关也是由接口来控制，所以判断是后端问题。
同时查询到项目使用的[阿里云oss](https://help.aliyun.com/zh/oss/user-guide/auto-rotate-4?spm=a2c4g.11186623.0.0.12ad1fb8QFq3kG)有这么一个参数：auto-orient，用来控制图片是否自适应旋转

![oss参数](<Pasted image 20240507091603.png>)

所以问题原因就是：根据watermark传参的不同，后端代码误配置了不同的auto-orient，导致图片出现旋转问题。

将问题反馈给后端，解决~！
